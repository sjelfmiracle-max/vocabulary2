<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ—¥è¯­å•è¯å­¦ä¹  - ä¸‰æ¨¡å¼ç‰ˆ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            font-family: -apple-system, BlinkMacSystemFont, 'PingFang SC', 'Microsoft YaHei', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 15px;
            color: #333;
        }
        
        .wechat-app {
            max-width: 100%;
            background: white;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            min-height: calc(100vh - 30px);
            display: flex;
            flex-direction: column;
        }
        
        .app-header {
            background: linear-gradient(135deg, #4b6cb7 0%, #182848 100%);
            color: white;
            padding: 25px 20px;
            text-align: center;
            position: relative;
            flex-shrink: 0;
        }
        
        .header-content {
            position: relative;
            z-index: 2;
        }
        
        h1 {
            font-size: 1.8rem;
            margin-bottom: 8px;
            font-weight: 600;
        }
        
        .subtitle {
            font-size: 0.9rem;
            opacity: 0.9;
            margin-bottom: 15px;
        }
        
        .stats-bar {
            display: flex;
            justify-content: space-around;
            background: rgba(255, 255, 255, 0.1);
            padding: 12px;
            border-radius: 10px;
            backdrop-filter: blur(10px);
            margin-top: 10px;
        }
        
        .stat-item {
            text-align: center;
        }
        
        .stat-value {
            font-size: 1.4rem;
            font-weight: bold;
            display: block;
        }
        
        .stat-label {
            font-size: 0.8rem;
            opacity: 0.8;
        }
        
        .app-body {
            padding: 20px;
            flex: 1;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }
        
        .card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            border: 1px solid #f0f0f0;
        }
        
        .big-button {
            display: block;
            width: 100%;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: bold;
            margin: 15px 0;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
            text-decoration: none;
        }
        
        .big-button:active {
            transform: scale(0.98);
            opacity: 0.9;
        }
        
        .button-secondary {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }
        
        .button-success {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }
        
        .button-warning {
            background: linear-gradient(135deg, #ff9a9e 0%, #fad0c4 100%);
        }
        
        .study-card {
            text-align: center;
        }
        
        .question {
            font-size: 2rem;
            margin: 30px 0;
            color: #182848;
            font-weight: bold;
            min-height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            line-height: 1.4;
            padding: 0 10px;
            word-break: break-all;
        }
        
        .mode-indicator {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: bold;
            margin-left: 10px;
            vertical-align: middle;
        }
        
        .mode-kanji {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
        }
        
        .mode-kana {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
        }
        
        .mode-mixed {
            background: linear-gradient(135deg, #ff9a9e 0%, #fad0c4 100%);
            color: #333;
        }
        
        .options-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
            margin: 25px 0;
        }
        
        .option-btn {
            padding: 20px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            background: white;
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
            touch-action: manipulation;
        }
        
        .option-btn:active {
            transform: scale(0.98);
        }
        
        .option-btn.selected {
            border-color: #667eea;
            background: #f0f5ff;
            font-weight: bold;
        }
        
        .option-btn.correct {
            border-color: #28a745;
            background: #d4edda;
            color: #155724;
        }
        
        .option-btn.incorrect {
            border-color: #dc3545;
            background: #f8d7da;
            color: #721c24;
        }
        
        .result {
            font-size: 1.3rem;
            font-weight: bold;
            margin: 20px 0;
            min-height: 40px;
        }
        
        .result.correct {
            color: #28a745;
        }
        
        .result.incorrect {
            color: #dc3545;
        }
        
        .controls {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 25px;
        }
        
        .control-btn {
            padding: 15px;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .control-btn:active {
            transform: scale(0.96);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #4b6cb7 0%, #182848 100%);
            color: white;
        }
        
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        
        .btn-success {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
        }
        
        .btn-warning {
            background: linear-gradient(135deg, #ffc107 0%, #ff9800 100%);
            color: #333;
        }
        
        .progress-container {
            margin: 20px 0;
        }
        
        .progress-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 0.9rem;
            color: #666;
        }
        
        .progress-bar {
            height: 10px;
            background: #e9ecef;
            border-radius: 5px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4b6cb7, #667eea);
            border-radius: 5px;
            transition: width 0.5s;
            width: 0%;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 25px;
            max-width: 500px;
            width: 100%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        }
        
        .modal-header {
            font-size: 1.3rem;
            font-weight: bold;
            margin-bottom: 20px;
            color: #182848;
            text-align: center;
        }
        
        .modal-close {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            font-size: 1.5rem;
            color: #666;
            cursor: pointer;
        }
        
        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .setting-label {
            font-size: 1rem;
            color: #333;
        }
        
        .mode-selector {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 10px;
            margin: 15px 0;
        }
        
        .mode-select-btn {
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            background: white;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
            font-weight: 500;
        }
        
        .mode-select-btn:active {
            transform: scale(0.98);
        }
        
        .mode-select-btn.active {
            border-color: #667eea;
            background: #f0f5ff;
            font-weight: bold;
        }
        
        .wechat-switch {
            position: relative;
            width: 50px;
            height: 26px;
        }
        
        .wechat-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .switch-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }
        
        .switch-slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        
        input:checked + .switch-slider {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        input:checked + .switch-slider:before {
            transform: translateX(24px);
        }
        
        .word-list {
            max-height: 300px;
            overflow-y: auto;
            margin: 15px 0;
        }
        
        .word-item {
            padding: 12px;
            border-bottom: 1px solid #f0f0f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .word-item:last-child {
            border-bottom: none;
        }
        
        .word-text {
            font-size: 1.1rem;
        }
        
        .kanji {
            font-weight: bold;
        }
        
        .kana {
            color: #667eea;
            margin-left: 8px;
        }
        
        .word-stats {
            font-size: 0.8rem;
            color: #666;
        }
        
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            border-top: 1px solid #e0e0e0;
            display: flex;
            padding: 10px 0;
            z-index: 100;
        }
        
        .nav-item {
            flex: 1;
            text-align: center;
            padding: 12px 0;
            color: #666;
            font-size: 0.9rem;
            text-decoration: none;
            transition: all 0.3s;
        }
        
        .nav-item.active {
            color: #667eea;
            font-weight: bold;
        }
        
        .nav-icon {
            font-size: 1.2rem;
            margin-bottom: 5px;
            display: block;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .category-selector {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin: 15px 0;
        }
        
        .category-btn {
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            background: white;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .category-btn.active {
            border-color: #667eea;
            background: #f0f5ff;
            font-weight: bold;
        }
        
        .search-box {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1rem;
            margin-bottom: 15px;
        }
        
        .mastery-badge {
            padding: 3px 8px;
            border-radius: 10px;
            font-size: 0.8rem;
            font-weight: bold;
        }
        
        .badge-mastered {
            background: #d4edda;
            color: #155724;
        }
        
        .badge-learning {
            background: #fff3cd;
            color: #856404;
        }
        
        .badge-new {
            background: #f8d7da;
            color: #721c24;
        }
        
        @media (max-width: 768px) {
            .question {
                font-size: 1.6rem;
            }
            
            .option-btn {
                padding: 18px;
                font-size: 1.1rem;
            }
            
            .big-button {
                padding: 18px;
            }
            
            .controls {
                grid-template-columns: 1fr;
            }
            
            .category-selector {
                grid-template-columns: 1fr;
            }
            
            .mode-selector {
                grid-template-columns: 1fr;
            }
        }
        
        input, select, textarea {
            font-size: 16px !important;
        }
        
        /* æ»šåŠ¨æ¡æ ·å¼ */
        ::-webkit-scrollbar {
            width: 6px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 3px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 3px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8;
        }
        
        .mode-stats {
            display: flex;
            justify-content: space-around;
            margin: 15px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
        }
        
        .mode-stat-item {
            text-align: center;
        }
        
        .mode-stat-value {
            font-size: 1.2rem;
            font-weight: bold;
            display: block;
            color: #182848;
        }
        
        .mode-stat-label {
            font-size: 0.8rem;
            color: #666;
        }
    </style>
</head>
<body>
    <div class="wechat-app">
        <!-- ä¸»ç•Œé¢ -->
        <div id="mainScreen" class="tab-content active">
            <div class="app-header">
                <div class="header-content">
                    <h1>æ—¥è¯­å•è¯å­¦ä¹ </h1>
                    <div class="subtitle">ä¸‰æ¨¡å¼ç‰ˆ - å‡åé€‰æ±‰å­—/æ±‰å­—å†™å‡å/æ··åˆæ¨¡å¼</div>
                    <div class="stats-bar">
                        <div class="stat-item">
                            <span class="stat-value" id="totalWords">156</span>
                            <span class="stat-label">æ€»å•è¯</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-value" id="masteredCount">0</span>
                            <span class="stat-label">å·²æŒæ¡</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-value" id="accuracyRate">0%</span>
                            <span class="stat-label">æ­£ç¡®ç‡</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="app-body">
                <!-- å­¦ä¹ å¡ç‰‡ -->
                <div class="card study-card" id="studyCard">
                    <div class="question" id="questionText">
                        é€‰æ‹©å­¦ä¹ æ¨¡å¼å¼€å§‹
                    </div>
                    
                    <div class="mode-stats">
                        <div class="mode-stat-item">
                            <span class="mode-stat-value" id="modeKanjiAccuracy">0%</span>
                            <span class="mode-stat-label">å‡åé€‰æ±‰å­—</span>
                        </div>
                        <div class="mode-stat-item">
                            <span class="mode-stat-value" id="modeKanaAccuracy">0%</span>
                            <span class="mode-stat-label">æ±‰å­—å†™å‡å</span>
                        </div>
                        <div class="mode-stat-item">
                            <span class="mode-stat-value" id="modeMixedAccuracy">0%</span>
                            <span class="mode-stat-label">æ··åˆæ¨¡å¼</span>
                        </div>
                    </div>
                    
                    <div class="options-grid" id="optionsGrid" style="display: none;"></div>
                    
                    <div class="result" id="resultText"></div>
                    
                    <div class="progress-container">
                        <div class="progress-label">
                            <span>å­¦ä¹ è¿›åº¦</span>
                            <span id="progressText">0/0</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="progressFill"></div>
                        </div>
                    </div>
                    
                    <div class="controls" id="studyControls">
                        <button class="control-btn btn-primary" id="startBtn">å¼€å§‹å­¦ä¹ </button>
                        <button class="control-btn btn-success" id="reviewBtn">å¤ä¹ æ¨¡å¼</button>
                        <button class="control-btn btn-primary" id="checkBtn" style="display: none;">æäº¤ç­”æ¡ˆ</button>
                        <button class="control-btn btn-secondary" id="nextBtn" style="display: none;">ä¸‹ä¸€é¢˜</button>
                    </div>
                </div>
                
                <!-- æ¨¡å¼é€‰æ‹© -->
                <div class="card">
                    <div class="mode-selector">
                        <button class="mode-select-btn active" data-mode="kana-to-kanji" onclick="selectStudyMode('kana-to-kanji')">
                            å‡åé€‰æ±‰å­—
                        </button>
                        <button class="mode-select-btn" data-mode="kanji-to-kana" onclick="selectStudyMode('kanji-to-kana')">
                            æ±‰å­—å†™å‡å
                        </button>
                        <button class="mode-select-btn" data-mode="mixed" onclick="selectStudyMode('mixed')">
                            æ··åˆæ¨¡å¼
                        </button>
                    </div>
                    
                    <button class="big-button button-secondary" onclick="switchTab('words')">
                        ğŸ“š å•è¯ç®¡ç† (156ä¸ª)
                    </button>
                    <button class="big-button button-success" onclick="switchTab('stats')">
                        ğŸ“Š å­¦ä¹ ç»Ÿè®¡
                    </button>
                    <button class="big-button" onclick="switchTab('settings')">
                        âš™ï¸ å­¦ä¹ è®¾ç½®
                    </button>
                </div>
            </div>
        </div>
        
        <!-- å•è¯ç®¡ç†é¡µé¢ -->
        <div id="wordsScreen" class="tab-content">
            <div class="app-header">
                <div class="header-content">
                    <h1>å•è¯ç®¡ç†</h1>
                    <div class="subtitle">å…±156ä¸ªå•è¯ï¼Œæ”¯æŒåˆ†ç±»å­¦ä¹ </div>
                </div>
            </div>
            
            <div class="app-body">
                <div class="card">
                    <input type="text" class="search-box" id="wordSearch" placeholder="æœç´¢æ±‰å­—æˆ–å‡å..." oninput="filterWords()">
                    
                    <div class="category-selector">
                        <button class="category-btn active" onclick="filterByCategory('all')">å…¨éƒ¨å•è¯</button>
                        <button class="category-btn" onclick="filterByCategory('people')">äººç‰©ç›¸å…³</button>
                        <button class="category-btn" onclick="filterByCategory('school')">å­¦æ ¡ç›¸å…³</button>
                        <button class="category-btn" onclick="filterByCategory('daily')">æ—¥å¸¸ç”Ÿæ´»</button>
                        <button class="category-btn" onclick="filterByCategory('time')">æ—¶é—´æ—¥æœŸ</button>
                    </div>
                    
                    <div class="word-list" id="wordListContent"></div>
                </div>
                
                <button class="big-button" onclick="switchTab('main')">è¿”å›å­¦ä¹ </button>
            </div>
        </div>
        
        <!-- ç»Ÿè®¡é¡µé¢ -->
        <div id="statsScreen" class="tab-content">
            <div class="app-header">
                <div class="header-content">
                    <h1>å­¦ä¹ ç»Ÿè®¡</h1>
                    <div class="subtitle">æŸ¥çœ‹æ‚¨çš„å­¦ä¹ è¿›åº¦å’Œæˆå°±</div>
                </div>
            </div>
            
            <div class="app-body">
                <div class="card">
                    <div class="stats-bar" style="margin: 20px 0;">
                        <div class="stat-item">
                            <span class="stat-value" id="statTotalWords">156</span>
                            <span class="stat-label">æ€»å•è¯</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-value" id="statLearned">0</span>
                            <span class="stat-label">å·²å­¦ä¹ </span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-value" id="statAccuracy">0%</span>
                            <span class="stat-label">æ­£ç¡®ç‡</span>
                        </div>
                    </div>
                    
                    <div class="progress-container">
                        <div class="progress-label">
                            <span>æ€»ä½“è¿›åº¦</span>
                            <span id="overallProgress">0%</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="overallProgressFill" style="width: 0%"></div>
                        </div>
                    </div>
                    
                    <div style="margin-top: 25px;">
                        <h3 style="margin-bottom: 15px;">å„æ¨¡å¼æ­£ç¡®ç‡</h3>
                        <div class="mode-stats">
                            <div class="mode-stat-item">
                                <span class="mode-stat-value" id="statKanjiAccuracy">0%</span>
                                <span class="mode-stat-label">å‡åé€‰æ±‰å­—</span>
                            </div>
                            <div class="mode-stat-item">
                                <span class="mode-stat-value" id="statKanaAccuracy">0%</span>
                                <span class="mode-stat-label">æ±‰å­—å†™å‡å</span>
                            </div>
                            <div class="mode-stat-item">
                                <span class="mode-stat-value" id="statMixedAccuracy">0%</span>
                                <span class="mode-stat-label">æ··åˆæ¨¡å¼</span>
                            </div>
                        </div>
                    </div>
                    
                    <div style="margin-top: 25px;">
                        <h3 style="margin-bottom: 15px;">æŒæ¡ç¨‹åº¦åˆ†å¸ƒ</h3>
                        <div id="masteryDistribution"></div>
                    </div>
                    
                    <div style="margin-top: 25px;">
                        <h3 style="margin-bottom: 15px;">å­¦ä¹ è®°å½•</h3>
                        <div id="studyHistory"></div>
                    </div>
                </div>
                
                <button class="big-button" onclick="switchTab('main')">è¿”å›å­¦ä¹ </button>
            </div>
        </div>
        
        <!-- è®¾ç½®é¡µé¢ -->
        <div id="settingsScreen" class="tab-content">
            <div class="app-header">
                <div class="header-content">
                    <h1>å­¦ä¹ è®¾ç½®</h1>
                    <div class="subtitle">ä¸ªæ€§åŒ–æ‚¨çš„å­¦ä¹ ä½“éªŒ</div>
                </div>
            </div>
            
            <div class="app-body">
                <div class="card">
                    <div class="setting-item">
                        <span class="setting-label">æ‰“ä¹±å•è¯é¡ºåº</span>
                        <label class="wechat-switch">
                            <input type="checkbox" id="shuffleToggle" checked>
                            <span class="switch-slider"></span>
                        </label>
                    </div>
                    
                    <div class="setting-item">
                        <span class="setting-label">è‡ªåŠ¨ä¿å­˜è¿›åº¦</span>
                        <label class="wechat-switch">
                            <input type="checkbox" id="autoSaveToggle" checked>
                            <span class="switch-slider"></span>
                        </label>
                    </div>
                    
                    <div class="setting-item">
                        <span class="setting-label">æ¯è½®å­¦ä¹ å•è¯æ•°</span>
                        <select id="batchSize" style="padding: 8px; border-radius: 6px; border: 1px solid #ddd;">
                            <option value="10">10ä¸ª</option>
                            <option value="20" selected>20ä¸ª</option>
                            <option value="30">30ä¸ª</option>
                            <option value="50">50ä¸ª</option>
                            <option value="100">100ä¸ª</option>
                        </select>
                    </div>
                    
                    <button class="big-button" onclick="saveSettings()" style="margin-top: 20px;">
                        ğŸ’¾ ä¿å­˜è®¾ç½®
                    </button>
                    
                    <button class="big-button button-secondary" onclick="exportData()" style="margin-top: 10px;">
                        ğŸ“¤ å¯¼å‡ºå­¦ä¹ æ•°æ®
                    </button>
                    
                    <button class="big-button button-success" onclick="importData()" style="margin-top: 10px;">
                        ğŸ“¥ å¯¼å…¥å­¦ä¹ æ•°æ®
                    </button>
                    
                    <button class="big-button button-warning" onclick="resetData()" style="margin-top: 10px;">
                        ğŸ”„ é‡ç½®å­¦ä¹ æ•°æ®
                    </button>
                    
                    <div class="wechat-tips" style="margin-top: 20px; padding: 15px; background: #f0f5ff; border-radius: 10px; font-size: 0.9rem;">
                        <strong>ğŸ“± æ‰‹æœºä½¿ç”¨æç¤ºï¼š</strong>
                        <p style="margin-top: 8px;">1. æ•°æ®ä¿å­˜åœ¨æµè§ˆå™¨ä¸­ï¼Œæ¸…é™¤ç¼“å­˜ä¼šä¸¢å¤±æ•°æ®</p>
                        <p>2. å»ºè®®å®šæœŸä½¿ç”¨"å¯¼å‡ºæ•°æ®"åŠŸèƒ½å¤‡ä»½</p>
                        <p>3. æ¨ªå±æ¨¡å¼å¯è·å¾—æ›´å¥½ä½“éªŒ</p>
                        <p>4. ä¸‰ç§æ¨¡å¼å¯éšæ—¶åˆ‡æ¢</p>
                    </div>
                </div>
                
                <button class="big-button" onclick="switchTab('main')">è¿”å›å­¦ä¹ </button>
            </div>
        </div>
    </div>
    
    <!-- åº•éƒ¨å¯¼èˆª -->
    <div class="bottom-nav">
        <a href="#" class="nav-item active" onclick="switchTab('main')">
            <span class="nav-icon">ğŸ“–</span>
            <span>å­¦ä¹ </span>
        </a>
        <a href="#" class="nav-item" onclick="switchTab('words')">
            <span class="nav-icon">ğŸ“š</span>
            <span>å•è¯</span>
        </a>
        <a href="#" class="nav-item" onclick="switchTab('stats')">
            <span class="nav-icon">ğŸ“Š</span>
            <span>ç»Ÿè®¡</span>
        </a>
        <a href="#" class="nav-item" onclick="switchTab('settings')">
            <span class="nav-icon">âš™ï¸</span>
            <span>è®¾ç½®</span>
        </a>
    </div>

    <script>
        // ==================== å®Œæ•´å•è¯åº“ ====================
        const allWords = [
            // äººç‰©ç›¸å…³
            { id: 1, kanji: "åå‰", kana: "ãªã¾ãˆ", category: "people" },
            { id: 2, kanji: "ä¼šç¤¾å“¡", kana: "ã‹ã„ã—ã‚ƒã„ã‚“", category: "people" },
            { id: 3, kanji: "å­¦ç”Ÿ", kana: "ãŒãã›ã„", category: "people" },
            { id: 4, kanji: "ä¸­å›½äºº", kana: "ã¡ã‚…ã†ã”ãã˜ã‚“", category: "people" },
            { id: 5, kanji: "å¤§å­¦ç”Ÿ", kana: "ã ã„ãŒãã›ã„", category: "people" },
            { id: 6, kanji: "å‹é”", kana: "ã¨ã‚‚ã ã¡", category: "people" },
            { id: 7, kanji: "ç•™å­¦ç”Ÿ", kana: "ã‚Šã‚…ã†ãŒãã›ã„", category: "people" },
            { id: 8, kanji: "ä¸­å­¦ç”Ÿ", kana: "ã¡ã‚…ã†ãŒãã›ã„", category: "people" },
            { id: 9, kanji: "ç”Ÿå¾’", kana: "ã›ã„ã¨", category: "people" },
            { id: 10, kanji: "ä¹—å®¢", kana: "ã˜ã‚‡ã†ãã‚ƒã", category: "people" },
            { id: 11, kanji: "å…¨å“¡", kana: "ãœã‚“ã„ã‚“", category: "people" },
            { id: 12, kanji: "é‹è»¢æ‰‹", kana: "ã†ã‚“ã¦ã‚“ã—ã‚…", category: "people" },
            { id: 13, kanji: "æ•™å¸«", kana: "ãã‚‡ã†ã—", category: "people" },
            { id: 14, kanji: "ãŠé‡‘æŒã¡", kana: "ãŠã‹ã­ã‚‚ã¡", category: "people" },
            { id: 15, kanji: "å¾Œè¼©", kana: "ã“ã†ã¯ã„", category: "people" },
            { id: 16, kanji: "åŒç´šç”Ÿ", kana: "ã©ã†ãã‚…ã†ã›ã„", category: "people" },
            { id: 17, kanji: "æ­Œæ‰‹", kana: "ã‹ã—ã‚…", category: "people" },
            { id: 18, kanji: "ä»²è‰¯ã—", kana: "ãªã‹ã‚ˆã—", category: "people" },
            { id: 19, kanji: "ç”·ã®äºº", kana: "ãŠã¨ã“ã®ã²ã¨", category: "people" },
            { id: 20, kanji: "å¥³ã®äºº", kana: "ãŠã‚“ãªã®ã²ã¨", category: "people" },
            { id: 21, kanji: "ç›¸æ‰‹", kana: "ã‚ã„ã¦", category: "people" },
            { id: 22, kanji: "å¼Ÿ", kana: "ãŠã¨ã†ã¨", category: "people" },
            { id: 23, kanji: "ä¸¡è¦ª", kana: "ã‚Šã‚‡ã†ã—ã‚“", category: "people" },
            { id: 24, kanji: "äººæ•°", kana: "ã«ã‚“ãšã†", category: "people" },
            
            // å­¦æ ¡ç›¸å…³
            { id: 25, kanji: "å­¦æ ¡", kana: "ãŒã£ã“ã†", category: "school" },
            { id: 26, kanji: "å…ˆç”Ÿ", kana: "ã›ã‚“ã›ã„", category: "school" },
            { id: 27, kanji: "æ•™ç§‘æ›¸", kana: "ãã‚‡ã†ã‹ã—ã‚‡", category: "school" },
            { id: 28, kanji: "æœº", kana: "ã¤ããˆ", category: "school" },
            { id: 29, kanji: "æ¤…å­", kana: "ã„ã™", category: "school" },
            { id: 30, kanji: "è¾æ›¸", kana: "ã˜ã—ã‚‡", category: "school" },
            { id: 31, kanji: "æ•™å®¤", kana: "ãã‚‡ã†ã—ã¤", category: "school" },
            { id: 32, kanji: "å¸­", kana: "ã›ã", category: "school" },
            { id: 33, kanji: "è‹±èª", kana: "ãˆã„ã”", category: "school" },
            { id: 34, kanji: "ä¸­å›½èª", kana: "ã¡ã‚…ã†ã”ãã”", category: "school" },
            { id: 35, kanji: "ä½“è‚²é¤¨", kana: "ãŸã„ã„ãã‹ã‚“", category: "school" },
            { id: 36, kanji: "æœ¬æ£š", kana: "ã»ã‚“ã ãª", category: "school" },
            { id: 37, kanji: "è¬›å ‚", kana: "ã“ã†ã©ã†", category: "school" },
            { id: 38, kanji: "å°å­¦æ ¡", kana: "ã—ã‚‡ã†ãŒã£ã“ã†", category: "school" },
            { id: 39, kanji: "å­¦éƒ¨", kana: "ãŒãã¶", category: "school" },
            { id: 40, kanji: "ä¸€å¹´ç”Ÿ", kana: "ã„ã¡ã­ã‚“ã›ã„", category: "school" },
            { id: 41, kanji: "è‡ªå·±ç´¹ä»‹", kana: "ã˜ã“ã—ã‚‡ã†ã‹ã„", category: "school" },
            { id: 42, kanji: "å‹‰å¼·", kana: "ã¹ã‚“ãã‚‡ã†", category: "school" },
            { id: 43, kanji: "è©¦é¨“", kana: "ã—ã‘ã‚“", category: "school" },
            { id: 44, kanji: "å®¿é¡Œ", kana: "ã—ã‚…ãã ã„", category: "school" },
            { id: 45, kanji: "ç™ºéŸ³", kana: "ã¯ã¤ãŠã‚“", category: "school" },
            { id: 46, kanji: "ç ”ç©¶å®¤", kana: "ã‘ã‚“ãã‚…ã†ã—ã¤", category: "school" },
            { id: 47, kanji: "éƒ¨æ´»", kana: "ã¶ã‹ã¤", category: "school" },
            
            // æ—¥å¸¸ç”Ÿæ´»
            { id: 48, kanji: "æ—¥æœ¬", kana: "ã«ã»ã‚“", category: "daily" },
            { id: 49, kanji: "çµŒæ¸ˆ", kana: "ã‘ã„ã–ã„", category: "daily" },
            { id: 50, kanji: "äºŒäºº", kana: "ãµãŸã‚Š", category: "daily" },
            { id: 51, kanji: "æ–°è", kana: "ã—ã‚“ã¶ã‚“", category: "daily" },
            { id: 52, kanji: "é„", kana: "ã‹ã°ã‚“", category: "daily" },
            { id: 53, kanji: "æ‰‹å¸³", kana: "ã¦ã¡ã‚‡ã†", category: "daily" },
            { id: 54, kanji: "è‡ªç„¶", kana: "ã—ãœã‚“", category: "daily" },
            { id: 55, kanji: "éƒ½å¸‚", kana: "ã¨ã—", category: "daily" },
            { id: 56, kanji: "åŠªåŠ›", kana: "ã©ã‚Šã‚‡ã", category: "daily" },
            { id: 57, kanji: "éŸ“å›½", kana: "ã‹ã‚“ã“ã", category: "daily" },
            { id: 58, kanji: "å‚˜", kana: "ã‹ã•", category: "daily" },
            { id: 59, kanji: "è²¡å¸ƒ", kana: "ã•ã„ãµ", category: "daily" },
            { id: 60, kanji: "å­ä¾›", kana: "ã“ã©ã‚‚", category: "daily" },
            { id: 61, kanji: "å›½", kana: "ãã«", category: "daily" },
            { id: 62, kanji: "éµ", kana: "ã‹ã", category: "daily" },
            { id: 63, kanji: "è‡ªè»¢è»Š", kana: "ã˜ã¦ã‚“ã—ã‚ƒ", category: "daily" },
            { id: 64, kanji: "æ¡ˆå†…", kana: "ã‚ã‚“ãªã„", category: "daily" },
            { id: 65, kanji: "éƒ¨å±‹", kana: "ã¸ã‚„", category: "daily" },
            { id: 66, kanji: "çŒ«", kana: "ã­ã“", category: "daily" },
            { id: 67, kanji: "ç®±", kana: "ã¯ã“", category: "daily" },
            { id: 68, kanji: "ä¸­", kana: "ãªã‹", category: "daily" },
            { id: 69, kanji: "åº­", kana: "ã«ã‚", category: "daily" },
            { id: 70, kanji: "é‚ªé­”", kana: "ã˜ã‚ƒã¾", category: "daily" },
            { id: 71, kanji: "æ˜”", kana: "ã‚€ã‹ã—", category: "daily" },
            { id: 72, kanji: "ç©å…·", kana: "ãŠã‚‚ã¡ã‚ƒ", category: "daily" },
            { id: 73, kanji: "ä»Š", kana: "ã„ã¾", category: "daily" },
            { id: 74, kanji: "æ± ", kana: "ã„ã‘", category: "daily" },
            { id: 75, kanji: "çœ¼é¡", kana: "ã‚ãŒã­", category: "daily" },
            { id: 76, kanji: "æ™‚è¨ˆ", kana: "ã¨ã‘ã„", category: "daily" },
            { id: 77, kanji: "å¯®", kana: "ã‚Šã‚‡ã†", category: "daily" },
            { id: 78, kanji: "æœç‰©", kana: "ãã ã‚‚ã®", category: "daily" },
            { id: 79, kanji: "å¤§å¤‰", kana: "ãŸã„ã¸ã‚“", category: "daily" },
            { id: 80, kanji: "æ¢¨", kana: "ãªã—", category: "daily" },
            { id: 81, kanji: "ä¸€æ—¥", kana: "ã„ã¡ã«ã¡", category: "daily" },
            { id: 82, kanji: "é£Ÿäº‹", kana: "ã—ã‚‡ãã˜", category: "daily" },
            { id: 83, kanji: "ä¼šç¤¾", kana: "ã‹ã„ã—ã‚ƒ", category: "daily" },
            { id: 84, kanji: "æ™‚é–“", kana: "ã˜ã‹ã‚“", category: "daily" },
            { id: 85, kanji: "å±…é…’å±‹", kana: "ã„ã–ã‹ã‚„", category: "daily" },
            { id: 86, kanji: "ãŠé¢¨å‘‚", kana: "ãŠãµã‚", category: "daily" },
            { id: 87, kanji: "è²·ã„ç‰©", kana: "ã‹ã„ã‚‚ã®", category: "daily" },
            { id: 88, kanji: "æ³¨æ–‡", kana: "ã¡ã‚…ã†ã‚‚ã‚“", category: "daily" },
            { id: 89, kanji: "æ‰€", kana: "ã¨ã“ã‚", category: "daily" },
            { id: 90, kanji: "æœ¬å½“", kana: "ã»ã‚“ã¨ã†", category: "daily" },
            { id: 91, kanji: "æ¼«ç”»", kana: "ã¾ã‚“ãŒ", category: "daily" },
            { id: 92, kanji: "æµ·å¤–", kana: "ã‹ã„ãŒã„", category: "daily" },
            { id: 93, kanji: "èƒ½åŠ›", kana: "ã®ã†ã‚Šã‚‡ã", category: "daily" },
            { id: 94, kanji: "å°èª¬", kana: "ã—ã‚‡ã†ã›ã¤", category: "daily" },
            { id: 95, kanji: "æ­“è¿ä¼š", kana: "ã‹ã‚“ã’ã„ã‹ã„", category: "daily" },
            { id: 96, kanji: "é›»è©±", kana: "ã§ã‚“ã‚", category: "daily" },
            { id: 97, kanji: "ç”Ÿæ´»", kana: "ã›ã„ã‹ã¤", category: "daily" },
            { id: 98, kanji: "é§…", kana: "ãˆã", category: "daily" },
            { id: 99, kanji: "æœ€åˆ", kana: "ã•ã„ã—ã‚‡", category: "daily" },
            { id: 100, kanji: "å…ƒæ°—", kana: "ã’ã‚“ã", category: "daily" },
            { id: 101, kanji: "æœ€è¿‘", kana: "ã•ã„ãã‚“", category: "daily" },
            { id: 102, kanji: "æ®‹æ¥­", kana: "ã–ã‚“ãã‚‡ã†", category: "daily" },
            { id: 103, kanji: "å¤§æŸ„", kana: "ãŠãŠãŒã‚‰", category: "daily" },
            { id: 104, kanji: "æœ‰å", kana: "ã‚†ã†ã‚ã„", category: "daily" },
            { id: 105, kanji: "äº¤é€š", kana: "ã“ã†ã¤ã†", category: "daily" },
            { id: 106, kanji: "æš‡", kana: "ã²ã¾", category: "daily" },
            { id: 107, kanji: "æ–°é®®", kana: "ã—ã‚“ã›ã‚“", category: "daily" },
            { id: 108, kanji: "é“å…·", kana: "ã©ã†ã", category: "daily" },
            { id: 109, kanji: "å·", kana: "ã‹ã‚", category: "daily" },
            { id: 110, kanji: "åº—", kana: "ã¿ã›", category: "daily" },
            { id: 111, kanji: "éƒŠå¤–", kana: "ã“ã†ãŒã„", category: "daily" },
            { id: 112, kanji: "å…¨å›½", kana: "ãœã‚“ã“ã", category: "daily" },
            { id: 113, kanji: "å„åœ°", kana: "ã‹ãã¡", category: "daily" },
            { id: 114, kanji: "ç¿’æ…£", kana: "ã—ã‚…ã†ã‹ã‚“", category: "daily" },
            { id: 115, kanji: "æ€§æ ¼", kana: "ã›ã„ã‹ã", category: "daily" },
            { id: 116, kanji: "ä¸€ç•ª", kana: "ã„ã¡ã°ã‚“", category: "daily" },
            { id: 117, kanji: "ä½œã‚Šæ–¹", kana: "ã¤ãã‚Šã‹ãŸ", category: "daily" },
            { id: 118, kanji: "å‡ºæ¥ç«‹ã¦", kana: "ã§ããŸã¦", category: "daily" },
            { id: 119, kanji: "ç´ æ•µ", kana: "ã™ã¦ã", category: "daily" },
            { id: 120, kanji: "ã”é¦³èµ°", kana: "ã”ã¡ãã†", category: "daily" },
            { id: 121, kanji: "äºˆå®š", kana: "ã‚ˆã¦ã„", category: "daily" },
            { id: 122, kanji: "ç´„æŸ", kana: "ã‚„ããã", category: "daily" },
            { id: 123, kanji: "å†—è«‡", kana: "ã˜ã‚‡ã†ã ã‚“", category: "daily" },
            { id: 124, kanji: "åˆ‡ç¬¦", kana: "ãã£ã·", category: "daily" },
            { id: 125, kanji: "è·ç‰©", kana: "ã«ã‚‚ã¤", category: "daily" },
            { id: 126, kanji: "æœ¬å±‹", kana: "ã»ã‚“ã‚„", category: "daily" },
            { id: 127, kanji: "ç”º", kana: "ã¾ã¡", category: "daily" },
            { id: 128, kanji: "æœ¬", kana: "ã»ã‚“", category: "daily" },
            
            // æ—¶é—´æ—¥æœŸ
            { id: 129, kanji: "ä»Šæ—¥", kana: "ãã‚‡ã†", category: "time" },
            { id: 130, kanji: "å†¬ä¼‘ã¿", kana: "ãµã‚†ã‚„ã™ã¿", category: "time" },
            { id: 131, kanji: "æ™©ã”é£¯", kana: "ã°ã‚“ã”ã¯ã‚“", category: "time" },
            { id: 132, kanji: "æœã”ã¯ã‚“", kana: "ã‚ã•ã”ã¯ã‚“", category: "time" },
            { id: 133, kanji: "åˆå¾Œ", kana: "ã”ã”", category: "time" },
            { id: 134, kanji: "æœé£Ÿ", kana: "ã¡ã‚‡ã†ã—ã‚‡ã", category: "time" },
            { id: 135, kanji: "é€±æœ«", kana: "ã—ã‚…ã†ã¾ã¤", category: "time" },
            { id: 136, kanji: "å¹³æ—¥", kana: "ã¸ã„ã˜ã¤", category: "time" },
            { id: 137, kanji: "åˆå‰", kana: "ã”ãœã‚“", category: "time" },
            { id: 138, kanji: "æœˆæ›œæ—¥", kana: "ã’ã¤ã‚ˆã†ã³", category: "time" },
            { id: 139, kanji: "ç«æ›œæ—¥", kana: "ã‹ã‚ˆã†ã³", category: "time" },
            { id: 140, kanji: "æ°´æ›œæ—¥", kana: "ã™ã„ã‚ˆã†ã³", category: "time" },
            { id: 141, kanji: "æœ¨æ›œæ—¥", kana: "ã‚‚ãã‚ˆã†ã³", category: "time" },
            { id: 142, kanji: "é‡‘æ›œæ—¥", kana: "ãã‚“ã‚ˆã†ã³", category: "time" },
            { id: 143, kanji: "åœŸæ›œæ—¥", kana: "ã©ã‚ˆã†ã³", category: "time" },
            { id: 144, kanji: "æ—¥æ›œæ—¥", kana: "ã«ã¡ã‚ˆã†ã³", category: "time" },
            { id: 145, kanji: "æ˜¨æ—¥", kana: "ãã®ã†", category: "time" },
            { id: 146, kanji: "æ˜æ—¥", kana: "ã‚ã—ãŸ", category: "time" },
            { id: 147, kanji: "èª•ç”Ÿæ—¥", kana: "ãŸã‚“ã˜ã‚‡ã†ã³", category: "time" },
            
            // åœ°ç‚¹åœºæ‰€
            { id: 148, kanji: "å…¬åœ’", kana: "ã“ã†ãˆã‚“", category: "place" },
            { id: 149, kanji: "å»ºç‰©", kana: "ãŸã¦ã‚‚ã®", category: "place" },
            { id: 150, kanji: "å›³æ›¸é¤¨", kana: "ã¨ã—ã‚‡ã‹ã‚“", category: "place" },
            { id: 151, kanji: "æ˜ ç”»é¤¨", kana: "ãˆã„ãŒã‹ã‚“", category: "place" },
            { id: 152, kanji: "é£Ÿå ‚", kana: "ã—ã‚‡ãã©ã†", category: "place" },
            { id: 153, kanji: "æ—…è¡Œä¼šç¤¾", kana: "ã‚Šã‚‡ã“ã†ãŒã„ã—ã‚ƒ", category: "place" },
            { id: 154, kanji: "ä¼šè­°å®¤", kana: "ã‹ã„ãã—ã¤", category: "place" },
            { id: 155, kanji: "éš£", kana: "ã¨ãªã‚Š", category: "place" },
            { id: 156, kanji: "é‹å‹•å ´", kana: "ã†ã‚“ã©ã†ã˜ã‚‡ã†", category: "place" },
            { id: 157, kanji: "å–«èŒ¶åº—", kana: "ãã£ã•ã¦ã‚“", category: "place" },
            { id: 158, kanji: "ç¾å®¹é™¢", kana: "ã³ã‚ˆã†ã„ã‚“", category: "place" },
            { id: 159, kanji: "éƒµä¾¿å±€", kana: "ã‚†ã†ã³ã‚“ãã‚‡ã", category: "place" },
            
            // é£Ÿç‰©é¥®æ–™
            { id: 160, kanji: "é£Ÿã¹ç‰©", kana: "ãŸã¹ã‚‚ã®", category: "food" },
            { id: 161, kanji: "é£²ã¿ç‰©", kana: "ã®ã¿ã‚‚ã®", category: "food" },
            { id: 162, kanji: "æ–™ç†", kana: "ã‚Šã‚‡ã†ã‚Š", category: "food" },
            { id: 163, kanji: "ãŠè“å­", kana: "ãŠã‹ã—", category: "food" },
            
            // äº¤é€šå‡ºè¡Œ
            { id: 164, kanji: "æ–°å¹¹ç·š", kana: "ã—ã‚“ã‹ã‚“ã›ã‚“", category: "transport" },
            { id: 165, kanji: "é£›è¡Œæ©Ÿ", kana: "ã²ã“ã†ã", category: "transport" },
            { id: 166, kanji: "èˆ¹", kana: "ãµã­", category: "transport" },
            { id: 167, kanji: "é›»è»Š", kana: "ã§ã‚“ã—ã‚ƒ", category: "transport" },
            { id: 168, kanji: "è»Š", kana: "ãã‚‹ã¾", category: "transport" },
            
            // æ–¹å‘ä½ç½®
            { id: 169, kanji: "å—", kana: "ã¿ãªã¿", category: "place" },
            { id: 170, kanji: "åŒ—", kana: "ããŸ", category: "place" },
            { id: 171, kanji: "é•ã†", kana: "ã¡ãŒã†", category: "daily" },
            { id: 172, kanji: "ç°¡å˜", kana: "ã‹ã‚“ãŸã‚“", category: "daily" },
            { id: 173, kanji: "éŸ³æ¥½", kana: "ãŠã‚“ãŒã", category: "daily" }
        ];
        
        // åˆå§‹åŒ–å˜é‡
        let currentWordIndex = 0;
        let currentStudyMode = 'kana-to-kanji'; // é»˜è®¤æ¨¡å¼ï¼šå‡åé€‰æ±‰å­—
        let selectedOption = null;
        let studyData = {
            learnedWords: {},
            stats: {
                correct: 0,
                wrong: 0,
                totalQuestions: 0,
                lastStudy: null,
                studyDays: [],
                totalTime: 0,
                modeStats: {
                    'kana-to-kanji': { correct: 0, total: 0 },
                    'kanji-to-kana': { correct: 0, total: 0 },
                    'mixed': { correct: 0, total: 0 }
                }
            },
            settings: {
                shuffle: true,
                autoSave: true,
                batchSize: 20
            },
            sessionStart: null
        };
        
        let currentStudyWords = [];
        let filteredWords = [...allWords];
        let currentCategory = 'all';
        
        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            loadStudyData();
            updateStatsDisplay();
            renderWordList();
            updateWordCounts();
            updateModeAccuracyDisplay();
            
            // ç»‘å®šäº‹ä»¶
            document.getElementById('startBtn').addEventListener('click', startStudy);
            document.getElementById('reviewBtn').addEventListener('click', startReview);
            document.getElementById('checkBtn').addEventListener('click', checkAnswer);
            document.getElementById('nextBtn').addEventListener('click', nextQuestion);
            
            // è®¾ç½®åˆ‡æ¢
            document.getElementById('shuffleToggle').addEventListener('change', function() {
                studyData.settings.shuffle = this.checked;
                if (studyData.settings.autoSave) saveStudyData();
            });
            
            document.getElementById('autoSaveToggle').addEventListener('change', function() {
                studyData.settings.autoSave = this.checked;
                saveStudyData();
            });
            
            document.getElementById('batchSize').addEventListener('change', function() {
                studyData.settings.batchSize = parseInt(this.value);
                if (studyData.settings.autoSave) saveStudyData();
            });
            
            // åˆå§‹åŒ–è®¾ç½®
            document.getElementById('shuffleToggle').checked = studyData.settings.shuffle;
            document.getElementById('autoSaveToggle').checked = studyData.settings.autoSave;
            document.getElementById('batchSize').value = studyData.settings.batchSize;
            
            // æ›´æ–°æ€»å•è¯æ•°æ˜¾ç¤º
            document.getElementById('totalWords').textContent = allWords.length;
            document.getElementById('statTotalWords').textContent = allWords.length;
        });
        
        // é€‰æ‹©å­¦ä¹ æ¨¡å¼
        function selectStudyMode(mode) {
            currentStudyMode = mode;
            
            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            document.querySelectorAll('.mode-select-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // æ›´æ–°æ˜¾ç¤º
            updateModeAccuracyDisplay();
        }
        
        // åˆ‡æ¢æ ‡ç­¾é¡µ
        function switchTab(tabName) {
            // éšè—æ‰€æœ‰æ ‡ç­¾é¡µ
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // æ˜¾ç¤ºç›®æ ‡æ ‡ç­¾é¡µ
            document.getElementById(tabName + 'Screen').classList.add('active');
            
            // æ›´æ–°å¯¼èˆªæ 
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            document.querySelectorAll('.nav-item')[getTabIndex(tabName)].classList.add('active');
            
            // æ›´æ–°å†…å®¹
            if (tabName === 'words') {
                renderWordList();
            } else if (tabName === 'stats') {
                updateStatsDisplay();
            }
        }
        
        function getTabIndex(tabName) {
            const tabs = ['main', 'words', 'stats', 'settings'];
            return tabs.indexOf(tabName);
        }
        
        // å¼€å§‹å­¦ä¹ 
        function startStudy() {
            startSession();
            
            // é€‰æ‹©å•è¯æ‰¹æ¬¡
            const batchSize = Math.min(studyData.settings.batchSize, allWords.length);
            let studyWords = [...allWords];
            
            if (studyData.settings.shuffle) {
                studyWords = shuffleArray(studyWords);
            }
            
            currentStudyWords = studyWords.slice(0, batchSize);
            currentWordIndex = 0;
            studyData.stats.correct = 0;
            studyData.stats.wrong = 0;
            studyData.stats.totalQuestions = 0;
            
            showQuestion();
        }
        
        // å¼€å§‹å¤ä¹ 
        function startReview() {
            startSession();
            
            // æ‰¾å‡ºæŒæ¡åº¦ä½çš„å•è¯
            let reviewWords = allWords.filter(word => {
                const learned = studyData.learnedWords[word.id];
                return !learned || learned.mastery < 70;
            });
            
            if (reviewWords.length === 0) {
                alert('æ­å–œï¼æ‰€æœ‰å•è¯éƒ½å·²æŒæ¡ï¼Œå¼€å§‹æ–°ä¸€è½®å­¦ä¹ å§ï¼');
                reviewWords = [...allWords];
            }
            
            const batchSize = Math.min(studyData.settings.batchSize, reviewWords.length);
            if (studyData.settings.shuffle) {
                reviewWords = shuffleArray(reviewWords);
            }
            
            currentStudyWords = reviewWords.slice(0, batchSize);
            currentWordIndex = 0;
            studyData.stats.correct = 0;
            studyData.stats.wrong = 0;
            studyData.stats.totalQuestions = 0;
            
            showQuestion();
        }
        
        // å¼€å§‹å­¦ä¹ ä¼šè¯
        function startSession() {
            studyData.sessionStart = new Date();
            
            // æ›´æ–°æŒ‰é’®
            document.getElementById('startBtn').style.display = 'none';
            document.getElementById('reviewBtn').style.display = 'none';
            document.getElementById('checkBtn').style.display = 'block';
            document.getElementById('nextBtn').style.display = 'none';
            document.getElementById('resultText').textContent = '';
            
            // æ˜¾ç¤ºé€‰é¡¹åŒºåŸŸ
            document.getElementById('optionsGrid').style.display = 'grid';
        }
        
        // æ˜¾ç¤ºé—®é¢˜
        function showQuestion() {
            if (!currentStudyWords || currentWordIndex >= currentStudyWords.length) {
                endStudy();
                return;
            }
            
            const word = currentStudyWords[currentWordIndex];
            selectedOption = null;
            
            // ç¡®å®šå½“å‰é—®é¢˜çš„æ¨¡å¼ï¼ˆå¦‚æœæ˜¯æ··åˆæ¨¡å¼ï¼Œéšæœºé€‰æ‹©ï¼‰
            let currentQuestionMode = currentStudyMode;
            if (currentStudyMode === 'mixed') {
                // æ··åˆæ¨¡å¼ä¸‹éšæœºé€‰æ‹©é—®é¢˜ç±»å‹
                const modes = ['kana-to-kanji', 'kanji-to-kana'];
                currentQuestionMode = modes[Math.floor(Math.random() * modes.length)];
            }
            
            // æ˜¾ç¤ºé—®é¢˜å’Œæ¨¡å¼æŒ‡ç¤ºå™¨
            if (currentQuestionMode === 'kana-to-kanji') {
                document.getElementById('questionText').innerHTML = `"${word.kana}" å¯¹åº”çš„æ±‰å­—æ˜¯ï¼Ÿ<span class="mode-indicator mode-kanji">å‡åé€‰æ±‰å­—</span>`;
            } else {
                document.getElementById('questionText').innerHTML = `"${word.kanji}" çš„å‡åæ˜¯ï¼Ÿ<span class="mode-indicator mode-kana">æ±‰å­—å†™å‡å</span>`;
            }
            
            // ç”Ÿæˆé€‰é¡¹
            const options = generateOptions(word, currentQuestionMode);
            const optionsGrid = document.getElementById('optionsGrid');
            optionsGrid.innerHTML = '';
            
            options.forEach((option, index) => {
                const button = document.createElement('button');
                button.className = 'option-btn';
                button.textContent = option;
                button.dataset.index = index;
                button.addEventListener('click', () => selectOption(button, index));
                optionsGrid.appendChild(button);
            });
            
            // ä¿å­˜å½“å‰é—®é¢˜çš„æ¨¡å¼
            window.currentQuestionMode = currentQuestionMode;
            window.currentWord = word;
            
            // æ›´æ–°è¿›åº¦
            updateProgress();
            
            // é‡ç½®ç»“æœ
            document.getElementById('resultText').textContent = '';
            document.getElementById('resultText').className = 'result';
        }
        
        // ç”Ÿæˆé€‰é¡¹
        function generateOptions(correctWord, mode) {
            const correctAnswer = mode === 'kana-to-kanji' ? correctWord.kanji : correctWord.kana;
            const options = [correctAnswer];
            
            // ä»å…¶ä»–å•è¯ä¸­éšæœºé€‰æ‹©ä¸¤ä¸ªé”™è¯¯é€‰é¡¹
            const otherWords = allWords.filter(w => w.id !== correctWord.id);
            const shuffled = shuffleArray([...otherWords]);
            
            for (let i = 0; i < 2 && i < shuffled.length; i++) {
                const wrongAnswer = mode === 'kana-to-kanji' ? shuffled[i].kanji : shuffled[i].kana;
                if (!options.includes(wrongAnswer)) {
                    options.push(wrongAnswer);
                }
            }
            
            // å¦‚æœé€‰é¡¹ä¸è¶³ï¼Œè¡¥å……é»˜è®¤é€‰é¡¹
            while (options.length < 3) {
                options.push(mode === 'kana-to-kanji' ? '---' : '---');
            }
            
            // æ‰“ä¹±é€‰é¡¹é¡ºåº
            return shuffleArray(options);
        }
        
        // é€‰æ‹©é€‰é¡¹
        function selectOption(button, index) {
            // æ¸…é™¤ä¹‹å‰çš„é€‰æ‹©
            document.querySelectorAll('.option-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
            
            // æ ‡è®°å½“å‰é€‰æ‹©
            button.classList.add('selected');
            selectedOption = {
                element: button,
                index: index,
                text: button.textContent
            };
            
            // å¯ç”¨æ£€æŸ¥æŒ‰é’®
            document.getElementById('checkBtn').disabled = false;
        }
        
        // æ£€æŸ¥ç­”æ¡ˆ
        function checkAnswer() {
            if (!selectedOption) {
                alert('è¯·å…ˆé€‰æ‹©ä¸€ä¸ªç­”æ¡ˆï¼');
                return;
            }
            
            const word = window.currentWord;
            const mode = window.currentQuestionMode;
            const correctAnswer = mode === 'kana-to-kanji' ? word.kanji : word.kana;
            const isCorrect = selectedOption.text === correctAnswer;
            
            // ç¦ç”¨æ‰€æœ‰é€‰é¡¹
            document.querySelectorAll('.option-btn').forEach(btn => {
                btn.disabled = true;
                if (btn.textContent === correctAnswer) {
                    btn.classList.add('correct');
                } else if (btn === selectedOption.element && !isCorrect) {
                    btn.classList.add('incorrect');
                }
            });
            
            // æ˜¾ç¤ºç»“æœ
            const resultText = document.getElementById('resultText');
            if (isCorrect) {
                resultText.textContent = 'âœ… å›ç­”æ­£ç¡®ï¼';
                resultText.className = 'result correct';
                studyData.stats.correct++;
                
                // æ›´æ–°æ¨¡å¼ç»Ÿè®¡
                if (studyData.stats.modeStats[mode]) {
                    studyData.stats.modeStats[mode].correct++;
                    studyData.stats.modeStats[mode].total++;
                }
            } else {
                resultText.textContent = `âŒ å›ç­”é”™è¯¯ï¼æ­£ç¡®ç­”æ¡ˆï¼š${correctAnswer}`;
                resultText.className = 'result incorrect';
                studyData.stats.wrong++;
                
                // æ›´æ–°æ¨¡å¼ç»Ÿè®¡
                if (studyData.stats.modeStats[mode]) {
                    studyData.stats.modeStats[mode].total++;
                }
            }
            
            // æ›´æ–°å•è¯æŒæ¡åº¦
            updateWordMastery(word.id, isCorrect, mode);
            studyData.stats.totalQuestions++;
            
            // æ›´æ–°æŒ‰é’®
            document.getElementById('checkBtn').style.display = 'none';
            document.getElementById('nextBtn').style.display = 'block';
            
            // æ›´æ–°ç»Ÿè®¡æ˜¾ç¤º
            updateStatsDisplay();
            updateModeAccuracyDisplay();
            
            // è‡ªåŠ¨ä¿å­˜
            if (studyData.settings.autoSave) {
                saveStudyData();
            }
        }
        
        // ä¸‹ä¸€é¢˜
        function nextQuestion() {
            currentWordIndex++;
            if (currentWordIndex < currentStudyWords.length) {
                showQuestion();
                document.getElementById('checkBtn').style.display = 'block';
                document.getElementById('checkBtn').disabled = true;
                document.getElementById('nextBtn').style.display = 'none';
            } else {
                endStudy();
            }
        }
        
        // ç»“æŸå­¦ä¹ 
        function endStudy() {
            const accuracy = studyData.stats.totalQuestions > 0 
                ? Math.round((studyData.stats.correct / studyData.stats.totalQuestions) * 100)
                : 0;
            
            // è®¡ç®—å­¦ä¹ æ—¶é—´
            if (studyData.sessionStart) {
                const endTime = new Date();
                const studyTime = Math.round((endTime - studyData.sessionStart) / 1000 / 60); // åˆ†é’Ÿ
                studyData.stats.totalTime += studyTime;
                studyData.sessionStart = null;
            }
            
            // æ›´æ–°å­¦ä¹ æ—¥æœŸ
            const today = new Date().toDateString();
            if (!studyData.stats.studyDays.includes(today)) {
                studyData.stats.studyDays.push(today);
            }
            studyData.stats.lastStudy = new Date().toLocaleString();
            
            document.getElementById('questionText').textContent = 'å­¦ä¹ å®Œæˆï¼';
            document.getElementById('optionsGrid').style.display = 'none';
            document.getElementById('resultText').innerHTML = `
                <div style="text-align: center;">
                    <div style="font-size: 1.5rem; margin-bottom: 10px;">ğŸ‰ æœ¬æ¬¡å­¦ä¹ å®Œæˆï¼</div>
                    <div>æ­£ç¡®ç‡ï¼š<strong>${accuracy}%</strong></div>
                    <div>æ­£ç¡®ï¼š${studyData.stats.correct}é¢˜ | é”™è¯¯ï¼š${studyData.stats.wrong}é¢˜</div>
                    <div style="margin-top: 10px; font-size: 0.9rem; color: #666;">
                        å­¦ä¹ äº† ${currentStudyWords.length} ä¸ªå•è¯
                    </div>
                </div>
            `;
            
            document.getElementById('checkBtn').style.display = 'none';
            document.getElementById('nextBtn').style.display = 'none';
            document.getElementById('startBtn').style.display = 'block';
            document.getElementById('reviewBtn').style.display = 'block';
            document.getElementById('startBtn').textContent = 'é‡æ–°å¼€å§‹';
            
            // ä¿å­˜æ•°æ®
            saveStudyData();
            updateStatsDisplay();
            renderWordList();
        }
        
        // æ›´æ–°å•è¯æŒæ¡åº¦
        function updateWordMastery(wordId, isCorrect, mode) {
            if (!studyData.learnedWords[wordId]) {
                studyData.learnedWords[wordId] = {
                    correct: 0,
                    wrong: 0,
                    mastery: 0,
                    lastReview: new Date().toISOString(),
                    reviewCount: 0,
                    modeStats: {
                        'kana-to-kanji': { correct: 0, total: 0 },
                        'kanji-to-kana': { correct: 0, total: 0 }
                    }
                };
            }
            
            const wordData = studyData.learnedWords[wordId];
            
            if (isCorrect) {
                wordData.correct++;
            } else {
                wordData.wrong++;
            }
            
            // æ›´æ–°æ¨¡å¼ç»Ÿè®¡
            if (wordData.modeStats[mode]) {
                if (isCorrect) {
                    wordData.modeStats[mode].correct++;
                }
                wordData.modeStats[mode].total++;
            }
            
            wordData.reviewCount++;
            const total = wordData.correct + wordData.wrong;
            wordData.mastery = total > 0 ? Math.round((wordData.correct / total) * 100) : 0;
            wordData.lastReview = new Date().toISOString();
            
            updateWordCounts();
        }
        
        // æ›´æ–°è¿›åº¦æ˜¾ç¤º
        function updateProgress() {
            const total = currentStudyWords ? currentStudyWords.length : 0;
            const progress = total > 0 ? Math.round(((currentWordIndex + 1) / total) * 100) : 0;
            
            document.getElementById('progressText').textContent = `${currentWordIndex + 1}/${total}`;
            document.getElementById('progressFill').style.width = `${progress}%`;
        }
        
        // æ›´æ–°ç»Ÿè®¡æ˜¾ç¤º
        function updateStatsDisplay() {
            const totalWords = allWords.length;
            const learnedCount = Object.keys(studyData.learnedWords).length;
            
            // å·²æŒæ¡å•è¯æ•°ï¼ˆæŒæ¡åº¦>=80%ï¼‰
            const mastered = Object.values(studyData.learnedWords).filter(data => data.mastery >= 80).length;
            
            // æ€»æ­£ç¡®ç‡
            const totalAnswered = studyData.stats.correct + studyData.stats.wrong;
            const accuracy = totalAnswered > 0 ? Math.round((studyData.stats.correct / totalAnswered) * 100) : 0;
            
            // æ›´æ–°æ˜¾ç¤º
            document.getElementById('masteredCount').textContent = mastered;
            document.getElementById('accuracyRate').textContent = `${accuracy}%`;
            
            document.getElementById('statLearned').textContent = learnedCount;
            document.getElementById('statAccuracy').textContent = `${accuracy}%`;
            
            // æ€»ä½“è¿›åº¦
            const overallProgress = Math.round((learnedCount / totalWords) * 100);
            document.getElementById('overallProgress').textContent = `${overallProgress}%`;
            document.getElementById('overallProgressFill').style.width = `${overallProgress}%`;
            
            // æŒæ¡ç¨‹åº¦åˆ†å¸ƒ
            updateMasteryDistribution();
            
            // å­¦ä¹ å†å²
            updateStudyHistory();
            
            // å„æ¨¡å¼æ­£ç¡®ç‡
            updateModeStatistics();
        }
        
        // æ›´æ–°æ¨¡å¼å‡†ç¡®ç‡æ˜¾ç¤º
        function updateModeAccuracyDisplay() {
            const kanjiMode = studyData.stats.modeStats['kana-to-kanji'];
            const kanaMode = studyData.stats.modeStats['kanji-to-kana'];
            const mixedMode = studyData.stats.modeStats['mixed'];
            
            const kanjiAccuracy = kanjiMode.total > 0 ? Math.round((kanjiMode.correct / kanjiMode.total) * 100) : 0;
            const kanaAccuracy = kanaMode.total > 0 ? Math.round((kanaMode.correct / kanaMode.total) * 100) : 0;
            const mixedAccuracy = mixedMode.total > 0 ? Math.round((mixedMode.correct / mixedMode.total) * 100) : 0;
            
            document.getElementById('modeKanjiAccuracy').textContent = `${kanjiAccuracy}%`;
            document.getElementById('modeKanaAccuracy').textContent = `${kanaAccuracy}%`;
            document.getElementById('modeMixedAccuracy').textContent = `${mixedAccuracy}%`;
        }
        
        // æ›´æ–°æ¨¡å¼ç»Ÿè®¡
        function updateModeStatistics() {
            const kanjiMode = studyData.stats.modeStats['kana-to-kanji'];
            const kanaMode = studyData.stats.modeStats['kanji-to-kana'];
            const mixedMode = studyData.stats.modeStats['mixed'];
            
            const kanjiAccuracy = kanjiMode.total > 0 ? Math.round((kanjiMode.correct / kanjiMode.total) * 100) : 0;
            const kanaAccuracy = kanaMode.total > 0 ? Math.round((kanaMode.correct / kanaMode.total) * 100) : 0;
            const mixedAccuracy = mixedMode.total > 0 ? Math.round((mixedMode.correct / mixedMode.total) * 100) : 0;
            
            document.getElementById('statKanjiAccuracy').textContent = `${kanjiAccuracy}%`;
            document.getElementById('statKanaAccuracy').textContent = `${kanaAccuracy}%`;
            document.getElementById('statMixedAccuracy').textContent = `${mixedAccuracy}%`;
        }
        
        // æ›´æ–°æŒæ¡ç¨‹åº¦åˆ†å¸ƒ
        function updateMasteryDistribution() {
            const distributionElement = document.getElementById('masteryDistribution');
            const masteryLevels = {
                mastered: 0,    // 80-100%
                learning: 0,    // 50-79%
                struggling: 0,  // 1-49%
                new: 0          // 0%
            };
            
            allWords.forEach(word => {
                const learned = studyData.learnedWords[word.id];
                if (!learned) {
                    masteryLevels.new++;
                } else if (learned.mastery >= 80) {
                    masteryLevels.mastered++;
                } else if (learned.mastery >= 50) {
                    masteryLevels.learning++;
                } else {
                    masteryLevels.struggling++;
                }
            });
            
            distributionElement.innerHTML = `
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                    <div style="background: #d4edda; padding: 10px; border-radius: 8px; text-align: center;">
                        <div style="font-size: 1.2rem; font-weight: bold;">${masteryLevels.mastered}</div>
                        <div style="font-size: 0.8rem;">å·²æŒæ¡</div>
                    </div>
                    <div style="background: #fff3cd; padding: 10px; border-radius: 8px; text-align: center;">
                        <div style="font-size: 1.2rem; font-weight: bold;">${masteryLevels.learning}</div>
                        <div style="font-size: 0.8rem;">å­¦ä¹ ä¸­</div>
                    </div>
                    <div style="background: #f8d7da; padding: 10px; border-radius: 8px; text-align: center;">
                        <div style="font-size: 1.2rem; font-weight: bold;">${masteryLevels.struggling}</div>
                        <div style="font-size: 0.8rem;">éœ€åŠ å¼º</div>
                    </div>
                    <div style="background: #e2e3e5; padding: 10px; border-radius: 8px; text-align: center;">
                        <div style="font-size: 1.2rem; font-weight: bold;">${masteryLevels.new}</div>
                        <div style="font-size: 0.8rem;">æœªå­¦ä¹ </div>
                    </div>
                </div>
            `;
        }
        
        // æ›´æ–°å­¦ä¹ å†å²
        function updateStudyHistory() {
            const historyElement = document.getElementById('studyHistory');
            const lastStudy = studyData.stats.lastStudy || 'æš‚æ— è®°å½•';
            const studyDays = studyData.stats.studyDays.length;
            const totalTime = Math.round(studyData.stats.totalTime);
            
            historyElement.innerHTML = `
                <div style="padding: 15px; background: #f8f9fa; border-radius: 10px;">
                    <div style="margin-bottom: 10px;">
                        <strong>ğŸ“… æœ€åå­¦ä¹ æ—¶é—´ï¼š</strong>${lastStudy}
                    </div>
                    <div style="margin-bottom: 10px;">
                        <strong>ğŸ“š å­¦ä¹ å¤©æ•°ï¼š</strong>${studyDays}å¤©
                    </div>
                    <div style="margin-bottom: 10px;">
                        <strong>â±ï¸ æ€»å­¦ä¹ æ—¶é•¿ï¼š</strong>${totalTime}åˆ†é’Ÿ
                    </div>
                    <div style="margin-bottom: 10px;">
                        <strong>âœ… æ€»æ­£ç¡®é¢˜æ•°ï¼š</strong>${studyData.stats.correct}
                    </div>
                    <div>
                        <strong>âŒ æ€»é”™è¯¯é¢˜æ•°ï¼š</strong>${studyData.stats.wrong}
                    </div>
                </div>
            `;
        }
        
        // æ›´æ–°å•è¯è®¡æ•°
        function updateWordCounts() {
            // è¿™é‡Œå¯ä»¥æ·»åŠ æ›´è¯¦ç»†çš„ç»Ÿè®¡é€»è¾‘
        }
        
        // æ¸²æŸ“å•è¯åˆ—è¡¨
        function renderWordList() {
            const wordListContent = document.getElementById('wordListContent');
            wordListContent.innerHTML = '';
            
            filteredWords.forEach(word => {
                const wordData = studyData.learnedWords[word.id];
                const mastery = wordData ? wordData.mastery : 0;
                
                let masteryBadge = '';
                if (mastery >= 80) {
                    masteryBadge = '<span class="mastery-badge badge-mastered">å·²æŒæ¡</span>';
                } else if (mastery >= 50) {
                    masteryBadge = `<span class="mastery-badge badge-learning">${mastery}%</span>`;
                } else if (mastery > 0) {
                    masteryBadge = `<span class="mastery-badge badge-new">${mastery}%</span>`;
                } else {
                    masteryBadge = '<span class="mastery-badge badge-new">æœªå­¦</span>';
                }
                
                const wordItem = document.createElement('div');
                wordItem.className = 'word-item';
                wordItem.innerHTML = `
                    <div class="word-text">
                        <span class="kanji">${word.kanji}</span>
                        <span class="kana">(${word.kana})</span>
                    </div>
                    <div class="word-stats">
                        ${masteryBadge}
                    </div>
                `;
                wordListContent.appendChild(wordItem);
            });
        }
        
        // è¿‡æ»¤å•è¯
        function filterWords() {
            const searchText = document.getElementById('wordSearch').value.toLowerCase();
            filteredWords = allWords.filter(word => 
                word.kanji.toLowerCase().includes(searchText) || 
                word.kana.toLowerCase().includes(searchText)
            );
            renderWordList();
        }
        
        // æŒ‰åˆ†ç±»è¿‡æ»¤
        function filterByCategory(category) {
            currentCategory = category;
            
            // æ›´æ–°åˆ†ç±»æŒ‰é’®çŠ¶æ€
            document.querySelectorAll('.category-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            if (category === 'all') {
                filteredWords = [...allWords];
            } else {
                filteredWords = allWords.filter(word => word.category === category);
            }
            
            renderWordList();
        }
        
        // ä¿å­˜è®¾ç½®
        function saveSettings() {
            saveStudyData();
            alert('è®¾ç½®å·²ä¿å­˜ï¼');
        }
        
        // å¯¼å‡ºæ•°æ®
        function exportData() {
            const dataStr = JSON.stringify(studyData, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `æ—¥è¯­å­¦ä¹ æ•°æ®_ä¸‰æ¨¡å¼ç‰ˆ_${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            alert('æ•°æ®å·²å¯¼å‡ºä¸ºJSONæ–‡ä»¶ï¼');
        }
        
        // å¯¼å…¥æ•°æ®
        function importData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            
            input.onchange = function(event) {
                const file = event.target.files[0];
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    try {
                        const importedData = JSON.parse(e.target.result);
                        studyData = importedData;
                        saveStudyData();
                        loadStudyData();
                        updateStatsDisplay();
                        renderWordList();
                        updateModeAccuracyDisplay();
                        alert('æ•°æ®å¯¼å…¥æˆåŠŸï¼');
                    } catch (error) {
                        alert('å¯¼å…¥å¤±è´¥ï¼šæ–‡ä»¶æ ¼å¼ä¸æ­£ç¡®');
                    }
                };
                
                reader.readAsText(file);
            };
            
            input.click();
        }
        
        // é‡ç½®æ•°æ®
        function resetData() {
            if (confirm('ç¡®å®šè¦é‡ç½®æ‰€æœ‰å­¦ä¹ æ•°æ®å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ï¼')) {
                studyData = {
                    learnedWords: {},
                    stats: {
                        correct: 0,
                        wrong: 0,
                        totalQuestions: 0,
                        lastStudy: null,
                        studyDays: [],
                        totalTime: 0,
                        modeStats: {
                            'kana-to-kanji': { correct: 0, total: 0 },
                            'kanji-to-kana': { correct: 0, total: 0 },
                            'mixed': { correct: 0, total: 0 }
                        }
                    },
                    settings: {
                        shuffle: true,
                        autoSave: true,
                        batchSize: 20
                    },
                    sessionStart: null
                };
                
                saveStudyData();
                updateStatsDisplay();
                renderWordList();
                updateModeAccuracyDisplay();
                alert('å­¦ä¹ æ•°æ®å·²é‡ç½®ï¼');
            }
        }
        
        // ä¿å­˜å­¦ä¹ æ•°æ®
        function saveStudyData() {
            try {
                localStorage.setItem('japaneseThreeModeStudyData', JSON.stringify(studyData));
            } catch (e) {
                console.error('ä¿å­˜æ•°æ®å¤±è´¥:', e);
            }
        }
        
        // åŠ è½½å­¦ä¹ æ•°æ®
        function loadStudyData() {
            try {
                const saved = localStorage.getItem('japaneseThreeModeStudyData');
                if (saved) {
                    studyData = JSON.parse(saved);
                }
            } catch (e) {
                console.error('åŠ è½½æ•°æ®å¤±è´¥:', e);
            }
        }
        
        // å·¥å…·å‡½æ•°ï¼šæ‰“ä¹±æ•°ç»„
        function shuffleArray(array) {
            const newArray = [...array];
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            return newArray;
        }
        
        // é¡µé¢å…³é—­å‰è‡ªåŠ¨ä¿å­˜
        window.addEventListener('beforeunload', function() {
            if (studyData.settings.autoSave) {
                saveStudyData();
            }
        });
        
        // é˜²æ­¢å¾®ä¿¡ä¸‹æ‹‰åˆ·æ–°
        if (/MicroMessenger/i.test(navigator.userAgent)) {
            let lastTouchY = 0;
            document.body.addEventListener('touchstart', function(e) {
                lastTouchY = e.touches[0].clientY;
            }, { passive: true });
            
            document.body.addEventListener('touchmove', function(e) {
                const touchY = e.touches[0].clientY;
                const scrollTop = document.documentElement.scrollTop || document.body.scrollTop;
                
                // å¦‚æœåœ¨é¡¶éƒ¨ä¸”å‘ä¸‹æ‹‰ï¼Œé˜»æ­¢é»˜è®¤è¡Œä¸º
                if (scrollTop === 0 && touchY > lastTouchY) {
                    e.preventDefault();
                }
                lastTouchY = touchY;
            }, { passive: false });
        }
    </script>
</body>
</html>